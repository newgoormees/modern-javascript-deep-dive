# 42장. 비동기 프로그래밍

## 목차 

- [42.1 동기 처리와 비동기 처리](#421-동기-처리와-비동기-처리)
  * [함수 실행 과정](#함수-실행-과정)
  * [자바스크립트 엔진의 특성](#자바스크립트-엔진의-특성)
  * [동기 처리와 비동기 처리](#동기-처리와-비동기-처리)
- [42.2 이벤트 루프와 태스크 큐](#422-이벤트-루프와-태스크-큐)
  * [자바스크립트 엔진의 구성 요소](#자바스크립트-엔진의-구성-요소)
  * [브라우저 환경이 제공하는 요소](#브라우저-환경이-제공하는-요소)
  * [브라우저가 제공하는 요소](#브라우저가-제공하는-요소)

---

## 42.1 동기 처리와 비동기 처리

### **함수 실행 과정**

1. 함수 호출
2. 함수 코드 평가 → 함수 실행 컨텍스트 생성
3. 함수 실행 컨텍스트
    - 실행 컨텍스트 스택(콜 스택)에 푸시: **함수 실행의 시작**
    - 함수 코드 실행
    - 실행 컨텍스트 스택에서 팝

따라서, 함수의 실행 순서는 실행 컨텍스트 스택으로 관리한다.

### 자바스크립트 엔진의 특성

<aside>

💡 **자바스크립트 엔진**은 단 하나의 실행 컨텍스트 스택을 갖는다: **싱글 스레드** 방식

</aside>

이는 즉, 동시에 2개 이상의 함수를 실행할 수 없다.

### 동기 처리와 비동기 처리

- 동기 처리
- 비동기 처리
    - 전통적으로 콜백 패턴을 사용했다.
        - 단점
            1. 가독성이 떨어진다.
            2. 에러 예외처리가 곤란하다.
            3. 여러 개의 비동기를 한 번에 처리하는 데 한계가 존재한다.
        
        → Promise 사용
        
    
    예시) `setTimeout`, `setInterval`, HTTP 요청, 이벤트 핸들러
    

## 42.2 이벤트 루프와 태스크 큐

<aside>

💡 자바스크립트의 동시성(concurrency)을 지원하는 것: **이벤트 루프** (브라우저 내장)

</aside>

### 자바스크립트 엔진의 구성 요소

- 콜 스택(실행 컨텍스트 스택)
- 힙
    - 객체가 저장되는 메모리 공간
    - 실행 컨텍스트는 힙에 저장된 객체를 참조
    - 자바스크립트는 원시 값도 객체이기에, **모든 값은 힙에 객체 형태**로 저장

자바스크립트는 다음으로만 구성되어 있기 때문에,
비동기 처리에서 소스코드의 평가와 실행을 제외한 모든 처리는 **브라우저** 혹은 **Node.js**가 담당한다.

- 예시)
    - 호출 스케줄링을 위한 타이머 설정
    - 콜백함수의 등록

### 브라우저 환경이 제공하는 요소

- 태스크 큐(이벤트 큐, 콜백 큐)
    - 비동기 함수의 콜백 함수 또는 이벤트 핸들러가 일시적으로 보관된다.
    - 타이머 만료 시 콜백함수를 태스크 큐에 푸시한다.
    
    *(+ 프로미스의 후속 처리 메서드의 콜백 함수 일시적으로 보관되는 마이크로태스크 큐도 존재)*
    
- 이벤트 루프
    - 콜 스택에 실행 중인 실행 컨텍스트 여부, 태스크 큐에 대기 중인 함수 여부를 확인한다.
    - 콜 스택 비어 있을 때(전역 실행 컨텍스트 포함) && 태스크 큐에 대기 중 함수 있을 때
        
        → FIFO로 태스크 큐에 대기중인 함수를 콜 스택으로 이동한다.
        

<aside>

💡 따라서, **싱글 스레드** 방식으로 동작하는 것은 브라우저가 아니라 브라우저에 내장된 **자바스크립트 엔진**이다. **브라우저**는 **멀티 스레드**로 동작한다.

</aside>

### 브라우저가 제공하는 요소

- 자바스크립트 엔진
- 렌더링 엔진
- Web API
    - DOM API
    - 타이머 함수
    - HTTP 요청(Ajax)