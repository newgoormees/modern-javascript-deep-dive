# 42장 비동기 프로그래밍

### 42.1 동기 처리와 비동기 처리

자바스크립트에는 스택 자료 구조를 가진 **실행 컨텍스트(콜 스택)**가 있다. 

```jsx
function func1() {
    function func2() {
        console.log('func2 호출');
    }
    func2();
    console.log('func1 호출');
}
func1();

```
<img src="./42장 비동기 프로그래밍/Untitled.png" >

위와 같이 호출된 순서대로 실행 컨텍스트 스택에 푸시되고, 실행된다.

이 스택에 함수가 푸시된다는 것이 함수 실행의 시작을 의미한다.

실행 순서 또한 스택과 동일하하게 LIFO 방식이다.

자바스크립트 엔진은 단 하나의 실행 컨텍스트를 갖는다. 즉, 동시에 2개 이상의 함수를 실행할 수 없다.

가장 상위의 태스크가 pop 되어 스택에서 제거되면 다음태스크가 실행되기 시작한다.

→ 즉, 자바스크립트 엔진은 한 번에 하나의 태스크만 실행할 수 있는 **싱글 스레드** 방식으로 동작한다.

- 블로킹(작업 중단): 처리에 시간이 많이 걸리는 태스크가 다른 태스크의 실행을 방해하는 현상
- **동기 처리**: 현재 실행 중인 태스크가 종료할 때까지 다음에 실행될 태스크가 대기하는 방식
    - 장점: 태스크의 실행 순서가 보장된다.
    - 단점: 앞선 태스크가 종료할 때까지 이후 태스크들이 블로킹된다.
- **비동기 처리**: 실행 중인 태스크가 종료되지 않은 상태라도 다음 태스크를 곧바로 실행하는 방식
    - 장점: 블로킹이 발생하지 않는다.
    - 단점: 태스크의 실행 순서가 보장되지 않는다.

비동기 함수는 보통 콜백 패턴을 사용한다. 이로 인해 발생하는 콜백 지옥은 가독성이 나빠지고, 비동기 처리 중 발생한 에러 처리를 곤란하게 한다. → Promise(45장)

- 비동기 처리 방식으로 동작하는 것: setTimeout, setinterval, HTTP 요청, 이벤트 핸들러

### 42.2 이벤트 루프와 태스크 큐

- **이벤트 루프**: 자바스크립트의 동시성을 지원, 브라우저에 내장되어 있는 기능

<img src="./42장 비동기 프로그래밍/Untitled 1.png" >

- 콜 스택: 실행 컨텍스트 스택
- 힙: 객체가 저장되는 메모리 공간, 콜 스택에서 참조함, 메모리 공간의 크기가 런타임에 동적으로 할당됨

비동기 처리에서 소스코드의 평가와 실행을 제외한 모든 처리는 브라우저 또는 Node.js가 담당한다.

- 자바스크립트 엔진: 콜백 함수의 평가와 실행
- 브라우저/Node.js: 호출 스케줄링을 위한 타이머 설정과 콜백 함수의 등록
- 브라우저 환경: 태스크 큐, 이벤트 루프를 제공

- 태스크 큐: 비동기 함수의 콜백 함수 또는 이밴트 헨들러가 일시적으로 보관되는 영역.
- 마이크로 태스크 큐: 프로미스의 후속 처리 메서드의 콜백 함수가 일시적으로 보관되는 곳
- 이벤트 루프: 콜 스택과 태스크 큐에 남아 있는 함수가 있는지 반복해서 확인. 콜 스택이 비어 있다면, FIFO 형식으로 태스크 큐 → 콜 스택으로 이동시키는 역할

- 자바 스크립트 엔진은 싱글 스레드로 동작하지만 브라우저는 멀티 스레드로 동작한다.